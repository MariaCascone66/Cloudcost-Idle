{% extends "layout.html" %}
{% block title %}Cost Summary{% endblock %}

{% block content %}
<h2 class="mb-3">Virtual Machines</h2>
<table class="table table-striped align-middle">
  <thead class="table-dark">
    <tr><th>Name</th><th>Status</th><th>Flavor</th><th>Uptimeâ€¯(h)</th>
        <th>CPUâ€¯%</th><th>Costâ€¯(h)</th><th>Est.â€¯30â€¯d</th></tr>
  </thead>
  <tbody>
    {% for r in rows %}
      <tr {% if r.idle %}class="table-warning"{% endif %}>
        <td>{{ r.name }}</td>
        <td>{{ r.status }}</td>
        <td>{{ r.flavor }}</td>
        <td>{{ r.hours }}</td>
        <td>{{ r.cpu }}</td>
        <td>{{ r.cost }}</td>
        <td>
          {% if r.idle %}
            <a href="#" data-bs-toggle="modal" data-bs-target="#idleModal"
               data-name="{{ r.name }}" data-hours="{{ r.hours }}"
               data-cost="{{ r.monthly }}">
               <span class="badge bg-danger">Idle ðŸ”•</span>
            </a>
          {% else %}
            {{ r.monthly }}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr class="table-secondary">
      <th colspan="6" class="text-end">Totale stimato /30â€¯d:</th>
      <th>{{ total }}</th>
    </tr>
  </tfoot>
</table>

{% include "idle_modal.html" %}
{% endblock %}

{% block scripts %}
<script>
const idleModal = document.getElementById('idleModal')
idleModal.addEventListener('show.bs.modal', event => {
  const btn  = event.relatedTarget
  idleModal.querySelector('#vmName').textContent  = btn.dataset.name
  idleModal.querySelector('#vmHours').textContent = btn.dataset.hours
  idleModal.querySelector('#vmCost').textContent  = btn.dataset.cost
})
</script>
{% endblock %}
